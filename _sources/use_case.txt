Use Case
========

Instagram-Foto → Twitter-Foto

Setup
-----

-   Installiere Instagram-Channel::

        c = Channel("instagram").save()
        t1 = Trigger(c, TRIGGER_NEW_PHOTO).save()
        t2 = Trigger(c, TRIGGER_NEW_PHOTO_WITH_HASHTAG).save()
        t3 = Trigger(c, TRIGGER_NEW_VIDEO).save()
        TriggerOutput(t1, "description", "text").save()
        TriggerOutput(t1, "image_hd", "image").save()
        TriggerOutput(t1, "image_sd", "image").save()
        TriggerOutput(t1, "hashtags", "text[]").save()
        (...)
        TriggerOutput(t3, "description", "text").save()
        TriggerOutput(t3, "video_hd", "video").save()

-   Installiere Twitter-Channel::

        c = Channel("twitter").save()
        a1 = Action(c, ActionType.post_status).save()
        a2 = Action(c, ActionType.post_image).save()
        a3 = Action(c, ActionType.post_image_with_text).save()
        ActionInput(a1, "text_data", "text").save()
        ActionInput(a2, "image_data", "image").save()
        ActionInput(a3, "text_data", "text").save()
        ActionInput(a3, "image_data", "image").save()

User erstellt Rezept
--------------------

-   User entscheidet sich für Trigger-Channel (Instagram)

    -   | OAuth, falls nötig, d.h. Popup mit Seite
        | ``/channels/<channelname>/authenticate?next=<current_url>``
        | ... OAuth-Flow ...
        | Redirect zu <current_url>

-   User entscheidet sich für Trigger (TRIGGER_NEW_PHOTO)

-   User legt Werte für Trigger-Fields fest (keine bei Trigger TRIGGER_NEW_PHOTO)

-   User entscheidet sich für Action-Channel

    -   OAuth, falls nötig, s.o.

-   User entscheidet sich für Action (ActionType.post_image_with_text)

-   User legt Action-Fields fest

    -   Je ActionInput für den ausgewählten Action Channel wird ein Textfeld
        angezeigt, in das Text und TriggerOutputs des ausgewählten Trigger
        Channels eingegeben werden. Diese Mappings werden mit dem Rezept
        gespeichert.

-   Aufruf des trigger-channels, so dass der trigger-channel die Chance hat,
    evt. Überprüfungen vorzunehmen oder zusätzliche OAuth-Flows für erweiterte
    Permissions durchzuführen. Gibt "confirm" oder "cancel" zurück

-   Aufruf des action-channels, dito.

-   Abspeichern des Rezepts::

        def save_recipe(trigger_name, action_name, mappings):
            t = Trigger.objects.get(trigger)
            a = Action.objects.get(action_name)
            r = Recipe(t, a, user).save()
            for key,value in mappings:
                RecipeMapping(r, value, key).save()


Rezept wird ausgeführt
----------------------

